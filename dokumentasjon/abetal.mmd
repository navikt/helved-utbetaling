
%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#07cff6', 'textColor': '#dad9e0', 'lineColor': '#07cff6'}}}%%

graph LR

subgraph Topologi
    %% TOPICS
    helved.utbetalinger.v1([helved.utbetalinger.v1])
	ktable-helved.utbetalinger.v1-repartition([ktable-helved.utbetalinger.v1-repartition])
	aap-periode-leftjoin-utbetalinger-repartition([aap-periode-leftjoin-utbetalinger-repartition])
	historisk-periode-leftjoin-utbetalinger-repartition([historisk-periode-leftjoin-utbetalinger-repartition])
	tp-periode-leftjoin-utbetalinger-repartition([tp-periode-leftjoin-utbetalinger-repartition])
	ts-periode-leftjoin-utbetalinger-repartition([ts-periode-leftjoin-utbetalinger-repartition])
	dp-periode-leftjoin-utbetalinger-repartition([dp-periode-leftjoin-utbetalinger-repartition])
	aap-utbetalinger-session-repartition([aap-utbetalinger-session-repartition])
	dp-utbetalinger-session-repartition([dp-utbetalinger-session-repartition])
	historisk-utbetalinger-session-repartition([historisk-utbetalinger-session-repartition])
	tp-utbetalinger-session-repartition([tp-utbetalinger-session-repartition])
	ts-utbetalinger-session-repartition([ts-utbetalinger-session-repartition])
	utbetalinger-groupby-sakkey-repartition([utbetalinger-groupby-sakkey-repartition])
	helved.pending-utbetalinger.v1([helved.pending-utbetalinger.v1])
	ktable-helved.pending-utbetalinger.v1-repartition([ktable-helved.pending-utbetalinger.v1-repartition])
	pk-leftjoin-pending-repartition([pk-leftjoin-pending-repartition])
	dptuple-leftjoin-saker-repartition([dptuple-leftjoin-saker-repartition])
	aaptuple-leftjoin-saker-repartition([aaptuple-leftjoin-saker-repartition])
	historisktuple-leftjoin-saker-repartition([historisktuple-leftjoin-saker-repartition])
	tptuple-leftjoin-saker-repartition([tptuple-leftjoin-saker-repartition])
	tstuple-leftjoin-saker-repartition([tstuple-leftjoin-saker-repartition])
	helved.saker.v1([helved.saker.v1])
	helved.status.v1([helved.status.v1])
	helved.fk.v1([helved.fk.v1])
	ktable-helved.fk.v1-repartition([ktable-helved.fk.v1-repartition])
	oppdrag-leftjoin-fks-repartition([oppdrag-leftjoin-fks-repartition])
	teamdagpenger.utbetaling.v1([teamdagpenger.utbetaling.v1])
	from-teamdagpenger.utbetaling.v1-repartition([from-teamdagpenger.utbetaling.v1-repartition])
	helved.utbetalinger-dp.v1([helved.utbetalinger-dp.v1])
	helved.simuleringer.v1([helved.simuleringer.v1])
	helved.oppdrag.v1([helved.oppdrag.v1])
	aap.utbetaling.v1([aap.utbetaling.v1])
	from-aap.utbetaling.v1-repartition([from-aap.utbetaling.v1-repartition])
	helved.utbetalinger-aap.v1([helved.utbetalinger-aap.v1])
	tilleggsstonader.utbetaling.v1([tilleggsstonader.utbetaling.v1])
	from-tilleggsstonader.utbetaling.v1-repartition([from-tilleggsstonader.utbetaling.v1-repartition])
	helved.utbetalinger-ts.v1([helved.utbetalinger-ts.v1])
	helved.utbetalinger-tp.v1([helved.utbetalinger-tp.v1])
	historisk.utbetaling.v1([historisk.utbetaling.v1])
	from-historisk.utbetaling.v1-repartition([from-historisk.utbetaling.v1-repartition])
	helved.utbetalinger-historisk.v1([helved.utbetalinger-historisk.v1])
	ktable-helved.saker.v1-repartition([ktable-helved.saker.v1-repartition])

    %% JOINS
    aap-periode-leftjoin-utbetalinger{leftjoin}
	historisk-periode-leftjoin-utbetalinger{leftjoin}
	tp-periode-leftjoin-utbetalinger{leftjoin}
	ts-periode-leftjoin-utbetalinger{leftjoin}
	dp-periode-leftjoin-utbetalinger{leftjoin}
	pk-leftjoin-pending{leftjoin}
	dptuple-leftjoin-saker{leftjoin}
	aaptuple-leftjoin-saker{leftjoin}
	historisktuple-leftjoin-saker{leftjoin}
	tptuple-leftjoin-saker{leftjoin}
	tstuple-leftjoin-saker{leftjoin}
	oppdrag-leftjoin-fks{leftjoin}

    %% STATE PROCESSORS
    
    
    %% STATE STORES
    helved.utbetalinger.v1-state-store-v2[(helved.utbetalinger.v1-state-store-v2)]
	helved.pending-utbetalinger.v1-state-store-v2[(helved.pending-utbetalinger.v1-state-store-v2)]
	helved.saker.v1-state-store-materialized[(helved.saker.v1-state-store-materialized)]
	helved.fk.v1-state-store-v2[(helved.fk.v1-state-store-v2)]
	dp-aggregate-store-v2-materialized[(dp-aggregate-store-v2-materialized)]
	dp-aggregate-store-v2[(dp-aggregate-store-v2)]
	dp-dedup-aggregate-v2[(dp-dedup-aggregate-v2)]
	aap-aggregate-store-v2-materialized[(aap-aggregate-store-v2-materialized)]
	aap-aggregate-store-v2[(aap-aggregate-store-v2)]
	aap-dedup-aggregate-v2[(aap-dedup-aggregate-v2)]
	ts-aggregate-store-v2-materialized[(ts-aggregate-store-v2-materialized)]
	ts-aggregate-store-v2[(ts-aggregate-store-v2)]
	ts-dedup-aggregate-v2[(ts-dedup-aggregate-v2)]
	tp-aggregate-store-v2-materialized[(tp-aggregate-store-v2-materialized)]
	tp-aggregate-store-v2[(tp-aggregate-store-v2)]
	tp-dedup-aggregate-v2[(tp-dedup-aggregate-v2)]
	historisk-aggregate-store-v2-materialized[(historisk-aggregate-store-v2-materialized)]
	historisk-aggregate-store-v2[(historisk-aggregate-store-v2)]
	historisk-dedup-aggregate-v2[(historisk-dedup-aggregate-v2)]
	helved.saker.v1-state-store[(helved.saker.v1-state-store)]
    
    %% DATABASES
    
    

    %% PROCESSOR API JOBS
    
    
    %% JOIN STREAMS
    aap-periode-leftjoin-utbetalinger-repartition --> aap-periode-leftjoin-utbetalinger
	helved.utbetalinger.v1-state-store-v2 --> aap-periode-leftjoin-utbetalinger
	aap-periode-leftjoin-utbetalinger --> aap-utbetalinger-session-repartition
	historisk-periode-leftjoin-utbetalinger-repartition --> historisk-periode-leftjoin-utbetalinger
	helved.utbetalinger.v1-state-store-v2 --> historisk-periode-leftjoin-utbetalinger
	historisk-periode-leftjoin-utbetalinger --> historisk-utbetalinger-session-repartition
	tp-periode-leftjoin-utbetalinger-repartition --> tp-periode-leftjoin-utbetalinger
	helved.utbetalinger.v1-state-store-v2 --> tp-periode-leftjoin-utbetalinger
	tp-periode-leftjoin-utbetalinger --> tp-utbetalinger-session-repartition
	ts-periode-leftjoin-utbetalinger-repartition --> ts-periode-leftjoin-utbetalinger
	helved.utbetalinger.v1-state-store-v2 --> ts-periode-leftjoin-utbetalinger
	ts-periode-leftjoin-utbetalinger --> ts-utbetalinger-session-repartition
	dp-periode-leftjoin-utbetalinger-repartition --> dp-periode-leftjoin-utbetalinger
	helved.utbetalinger.v1-state-store-v2 --> dp-periode-leftjoin-utbetalinger
	dp-periode-leftjoin-utbetalinger --> dp-utbetalinger-session-repartition
	pk-leftjoin-pending-repartition --> pk-leftjoin-pending
	helved.pending-utbetalinger.v1-state-store-v2 --> pk-leftjoin-pending
	pk-leftjoin-pending --> helved.utbetalinger.v1
	dptuple-leftjoin-saker-repartition --> dptuple-leftjoin-saker
	helved.saker.v1-state-store-materialized --> dptuple-leftjoin-saker
	dptuple-leftjoin-saker --> helved.status.v1
	dptuple-leftjoin-saker --> dp-periode-leftjoin-utbetalinger-repartition
	aaptuple-leftjoin-saker-repartition --> aaptuple-leftjoin-saker
	helved.saker.v1-state-store-materialized --> aaptuple-leftjoin-saker
	aaptuple-leftjoin-saker --> aap-periode-leftjoin-utbetalinger-repartition
	historisktuple-leftjoin-saker-repartition --> historisktuple-leftjoin-saker
	helved.saker.v1-state-store-materialized --> historisktuple-leftjoin-saker
	historisktuple-leftjoin-saker --> historisk-periode-leftjoin-utbetalinger-repartition
	tptuple-leftjoin-saker-repartition --> tptuple-leftjoin-saker
	helved.saker.v1-state-store-materialized --> tptuple-leftjoin-saker
	tptuple-leftjoin-saker --> tp-periode-leftjoin-utbetalinger-repartition
	tstuple-leftjoin-saker-repartition --> tstuple-leftjoin-saker
	helved.saker.v1-state-store-materialized --> tstuple-leftjoin-saker
	tstuple-leftjoin-saker --> ts-periode-leftjoin-utbetalinger-repartition
	oppdrag-leftjoin-fks-repartition --> oppdrag-leftjoin-fks
	helved.fk.v1-state-store-v2 --> oppdrag-leftjoin-fks
	oppdrag-leftjoin-fks --> pk-leftjoin-pending-repartition

    %% TABLE STREAMS
    

    %% JOB STREAMS
    
    
    %% BRANCH STREAMS
    

    %% REPARTITION STREAMS
    aap-periode-leftjoin-utbetalinger-repartition --> |rekey| aap-utbetalinger-session-repartition
	historisk-periode-leftjoin-utbetalinger-repartition --> |rekey| historisk-utbetalinger-session-repartition
	ktable-helved.utbetalinger.v1-repartition --> |rekey| utbetalinger-groupby-sakkey-repartition
	tp-periode-leftjoin-utbetalinger-repartition --> |rekey| tp-utbetalinger-session-repartition
	ts-periode-leftjoin-utbetalinger-repartition --> |rekey| ts-utbetalinger-session-repartition
	dp-periode-leftjoin-utbetalinger-repartition --> |rekey| dp-utbetalinger-session-repartition
	dptuple-leftjoin-saker-repartition --> |rekey| dp-periode-leftjoin-utbetalinger-repartition
	aaptuple-leftjoin-saker-repartition --> |rekey| aap-periode-leftjoin-utbetalinger-repartition
	historisktuple-leftjoin-saker-repartition --> |rekey| historisk-periode-leftjoin-utbetalinger-repartition
	tptuple-leftjoin-saker-repartition --> |rekey| tp-periode-leftjoin-utbetalinger-repartition
	tstuple-leftjoin-saker-repartition --> |rekey| ts-periode-leftjoin-utbetalinger-repartition
	oppdrag-leftjoin-fks-repartition --> |rekey| pk-leftjoin-pending-repartition
    
    %% BASIC STREAMS
    helved.utbetalinger.v1 --> ktable-helved.utbetalinger.v1-repartition
	helved.pending-utbetalinger.v1 --> ktable-helved.pending-utbetalinger.v1-repartition
	helved.fk.v1 --> ktable-helved.fk.v1-repartition
	teamdagpenger.utbetaling.v1 --> from-teamdagpenger.utbetaling.v1-repartition
	helved.utbetalinger-dp.v1 --> dptuple-leftjoin-saker-repartition
	from-teamdagpenger.utbetaling.v1-repartition --> dptuple-leftjoin-saker-repartition
	aap.utbetaling.v1 --> from-aap.utbetaling.v1-repartition
	helved.utbetalinger-aap.v1 --> aaptuple-leftjoin-saker-repartition
	from-aap.utbetaling.v1-repartition --> aaptuple-leftjoin-saker-repartition
	tilleggsstonader.utbetaling.v1 --> from-tilleggsstonader.utbetaling.v1-repartition
	helved.utbetalinger-ts.v1 --> tstuple-leftjoin-saker-repartition
	from-tilleggsstonader.utbetaling.v1-repartition --> tstuple-leftjoin-saker-repartition
	helved.utbetalinger-tp.v1 --> tptuple-leftjoin-saker-repartition
	historisk.utbetaling.v1 --> from-historisk.utbetaling.v1-repartition
	helved.utbetalinger-historisk.v1 --> historisktuple-leftjoin-saker-repartition
	from-historisk.utbetaling.v1-repartition --> historisktuple-leftjoin-saker-repartition
	helved.oppdrag.v1 --> oppdrag-leftjoin-fks-repartition
	helved.saker.v1 --> ktable-helved.saker.v1-repartition
    
    %% CUSTOM PROCESS STREAMS
    
end

%% COLORS
%% light    #dad9e0
%% purple   #78369f
%% pink     #c233b4
%% dark     #2a204a
%% blue     #07cff6

%% STYLES
style helved.utbetalinger.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style ktable-helved.utbetalinger.v1-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style aap-periode-leftjoin-utbetalinger-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style historisk-periode-leftjoin-utbetalinger-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style tp-periode-leftjoin-utbetalinger-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style ts-periode-leftjoin-utbetalinger-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style dp-periode-leftjoin-utbetalinger-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style aap-utbetalinger-session-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style dp-utbetalinger-session-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style historisk-utbetalinger-session-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style tp-utbetalinger-session-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style ts-utbetalinger-session-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style utbetalinger-groupby-sakkey-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.pending-utbetalinger.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style ktable-helved.pending-utbetalinger.v1-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style pk-leftjoin-pending-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style dptuple-leftjoin-saker-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style aaptuple-leftjoin-saker-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style historisktuple-leftjoin-saker-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style tptuple-leftjoin-saker-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style tstuple-leftjoin-saker-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.saker.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.status.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.fk.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style ktable-helved.fk.v1-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style oppdrag-leftjoin-fks-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style teamdagpenger.utbetaling.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style from-teamdagpenger.utbetaling.v1-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.utbetalinger-dp.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.simuleringer.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.oppdrag.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style aap.utbetaling.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style from-aap.utbetaling.v1-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.utbetalinger-aap.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style tilleggsstonader.utbetaling.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style from-tilleggsstonader.utbetaling.v1-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.utbetalinger-ts.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.utbetalinger-tp.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style historisk.utbetaling.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style from-historisk.utbetaling.v1-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.utbetalinger-historisk.v1 fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style ktable-helved.saker.v1-repartition fill:#c233b4, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.utbetalinger.v1-state-store-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.pending-utbetalinger.v1-state-store-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.saker.v1-state-store-materialized fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.fk.v1-state-store-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style dp-aggregate-store-v2-materialized fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style dp-aggregate-store-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style dp-dedup-aggregate-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style aap-aggregate-store-v2-materialized fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style aap-aggregate-store-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style aap-dedup-aggregate-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style ts-aggregate-store-v2-materialized fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style ts-aggregate-store-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style ts-dedup-aggregate-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style tp-aggregate-store-v2-materialized fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style tp-aggregate-store-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style tp-dedup-aggregate-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style historisk-aggregate-store-v2-materialized fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style historisk-aggregate-store-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style historisk-dedup-aggregate-v2 fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a
style helved.saker.v1-state-store fill:#78369f, stroke:#2a204a, stroke-width:2px, color:#2a204a

